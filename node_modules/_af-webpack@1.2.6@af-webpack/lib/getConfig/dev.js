"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _fs = require("fs");

var _path = require("path");

function _default(webpackConfig, opts) {
  webpackConfig.devtool(opts.devtool || 'cheap-module-source-map').output.pathinfo(true);
  webpackConfig.plugin('hmr').use(require('webpack/lib/HotModuleReplacementPlugin'));
  webpackConfig.when(!!opts.devServer, webpackConfig => webpackConfig.merge({
    devServer: opts.devServer
  }));

  if (process.env.HARD_SOURCE) {
    const pkgPath = (0, _path.join)(opts.cwd, 'package.json');

    if (!(0, _fs.existsSync)(pkgPath)) {
      (0, _fs.writeFileSync)(pkgPath, '{}', 'utf-8');
    }

    webpackConfig.plugin('hard-source').use(require('hard-source-webpack-plugin'), [{
      environmentHash: {
        root: process.cwd(),
        directories: ['config'],
        files: ['package-lock.json', 'yarn.lock', '.umirc.js', '.umirc.local.js']
      }
    }]);
  }
}